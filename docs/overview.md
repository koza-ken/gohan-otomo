# プロジェクト詳細仕様書

## プロジェクト概要

### アプリケーション名
🍚 ご飯のお供投稿アプリ（gohan-otomo）

### 目的・ビジョン
ご飯に合う食材や商品を手軽に探し、美味しそうな組み合わせを発見できるプラットフォームの提供。ユーザー同士の食体験共有を通じて、新しい食材や組み合わせの発見を促進する。

### ターゲットユーザー
- 料理に興味がある人
- 新しい食材を試したい人
- 食べ物の情報を共有したい人

## 実装状況

### 実装済み機能
- **ウェルカムアニメーション**: 初回アクセス時の稲穂→コンバイン→炊き立てご飯のアニメーション
- **ユーザー認証**: Deviseによる登録・ログイン（日本語対応フォーム、アイコン付き）
- **米テーマデザインシステム**: オレンジを基調とした統一されたUI・CSSコンポーネント
- **レスポンシブ対応**: モバイル・タブレット・デスクトップ完全対応
- **セッション管理**: 初回のみアニメーション表示、スキップ機能、Escキー対応

### 予定機能
投稿機能、いいね機能、プロフィール管理等（後述の詳細仕様参照）

## 機能詳細仕様

### 1. ユーザー認証・プロフィール機能

#### 1.1 ユーザー登録・認証
- **認証方式**: Devise（セッションベース）
- **必須項目**: メールアドレス、パスワード、表示名
- **任意項目**: プロフィール画像（今後実装予定）

#### 1.2 プロフィール機能
- **好きな食べ物**: テキスト形式で自由記述
- **嫌いな食べ物**: テキスト形式で自由記述
- **プロフィール公開設定**: 公開/非公開の切り替え
- **表示場所**: 投稿一覧、ユーザーページ、投稿詳細

### 2. 投稿機能（STI実装）

#### 2.1 投稿タイプ

##### おすすめ投稿（RecommendPost）
- **目的**: 商品・食材の紹介
- **必須項目**: タイトル、おすすめポイント
- **任意項目**: 通販リンク、画像
- **特徴**: 購入を促進する内容

##### 食べてみた投稿（ReportPost）
- **目的**: 実食レビュー
- **必須項目**: タイトル、感想
- **任意項目**: 評価点（1-5段階）、画像
- **特徴**: 実体験に基づく情報

#### 2.2 ハイブリッド画像取得機能

##### 画像取得優先順位
1. **ユーザーアップロード画像**: 最優先
2. **外部サイト画像**: 通販リンクがある場合
   - Amazon Product API
   - 楽天商品API
   - Open Graph画像
3. **プレースホルダー画像**: どちらもない場合

##### 技術仕様
- **画像処理**: Active Storage + image_processing
- **リサイズ**: 複数サイズ生成（サムネイル、詳細表示用）
- **フォーマット**: WebP対応（フォールバックあり）

### 3. 投稿一覧・検索機能

#### 3.1 一覧表示機能
- **表示形式**: 掲示板形式（カード型レイアウト）
- **ページネーション**: Kaminari（予定）
- **表示項目**:
  - 投稿画像（サムネイル）
  - タイトル
  - 投稿者表示名
  - 投稿者プロフィール（簡易表示）
  - いいね数
  - 投稿タイプ

#### 3.2 フィルター・検索機能
- **投稿タイプフィルター**: おすすめ/食べてみた
- **キーワード検索**: タイトル・内容を対象
- **並び替え**: 新着順、人気順（いいね数）
- **プロフィール検索**: 好き・嫌いな食べ物での絞り込み（今後実装予定）

### 4. いいね機能

#### 4.1 基本機能
- **対象**: すべての投稿
- **制限**: 1ユーザー1投稿につき1いいね
- **表示**: いいね数、いいね状態

#### 4.2 技術仕様
- **非同期処理**: Turbo を使用
- **重複防止**: DB制約 + アプリケーション制御
- **パフォーマンス**: カウンターキャッシュ（今後実装予定）

### 5. SNS連携機能

#### 5.1 X（旧Twitter）シェア
- **シェア内容**: 投稿タイプに応じた定型文 + 画像 + URL
- **おすすめ投稿**: 「美味しそうな○○を見つけました！」
- **食べてみた投稿**: 「○○を食べてみました！評価は★★★」
- **OGP対応**: 適切なメタタグ設定

## UI/UX設計

### デザインコンセプト
- **モバイルファースト**: スマートフォン最適化
- **直感的操作**: シンプルで分かりやすいUI
- **視覚重視**: 食べ物の写真を活かしたデザイン
- **高速表示**: パフォーマンス最適化

### カラーパレット（実装済み）
- **メインカラー**: オレンジ系（#f59e0b, #d97706）
- **サブカラー**: アンバー、クリーム色
- **背景グラデーション**: orange-50 → orange-100 → yellow-50
- **アクセント**: 温かい食欲をそそる色合い

### レスポンシブ対応
- **モバイル**: 320px-640px
- **タブレット**: 640px-1024px
- **デスクトップ**: 1024px以上

## データフロー

### 1. ユーザー登録フロー
```
1. ユーザー登録画面
2. メール認証（Devise標準）
3. プロフィール設定
4. 投稿一覧画面
```

### 2. 投稿作成フロー
```
1. 投稿タイプ選択
2. 投稿フォーム入力
3. 画像アップロード（任意）
4. 外部画像取得処理
5. 投稿保存
6. 一覧に反映
```

### 3. いいね機能フロー
```
1. いいねボタンクリック
2. Ajax通信（Turbo）
3. DB更新
4. UI更新（カウント・状態）
```

## セキュリティ要件

### 認証・認可
- **セッション管理**: Rails標準 + Devise
- **CSRF対策**: Rails標準機能
- **XSS対策**: ERBエスケープ
- **認可**: CanCanCanまたは独自実装

### データ保護
- **個人情報**: 最小限の収集
- **画像**: 適切なファイル形式チェック
- **入力値**: バリデーション + サニタイズ

### 外部API連携
- **APIキー**: 環境変数で管理
- **レート制限**: 適切な間隔制御
- **エラーハンドリング**: 障害時のフォールバック

## パフォーマンス要件

### 応答時間
- **ページ表示**: 2秒以内
- **画像読み込み**: 3秒以内
- **Ajax処理**: 1秒以内

### スケーラビリティ
- **同時接続数**: 100ユーザー（初期）
- **投稿数**: 10,000件（初期）
- **画像容量**: ユーザーあたり100MB

## 今後の拡張計画

### フェーズ2（中期）
- **レシピ機能**: 投稿から料理レシピ作成
- **フォロー機能**: ユーザー同士のフォロー
- **コメント機能**: 投稿へのコメント
- **タグ機能**: カテゴリ分類

### フェーズ3（長期）
- **AI活用**: 好みに基づくレコメンド
- **位置情報**: 地域特産品の投稿
- **EC連携**: 直接購入機能
- **API提供**: 外部サービス連携

## 開発・運用計画

### 開発期間（予定）
- **MVP**: 2-3ヶ月
- **β版**: 4-5ヶ月
- **正式リリース**: 6ヶ月

### 運用体制
- **保守**: 定期アップデート
- **監視**: エラー監視、パフォーマンス監視
- **バックアップ**: 日次バックアップ
- **スケールアウト**: ユーザー増加に応じた対応
