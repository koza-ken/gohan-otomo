<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ğŸš ã”é£¯ã®ãŠä¾›</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
</head>
<body class="overflow-hidden">
  <!-- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ -->
  <div id="animation-container" class="fixed inset-0 z-50 flex items-center justify-center">

    <!-- ç¨²ã®ã‚·ãƒ¼ãƒ³ -->
    <div id="rice-field" class="absolute inset-0 opacity-0 transition-opacity duration-1000">
      <div class="absolute inset-0 bg-gradient-to-b from-yellow-200 via-green-100 to-green-300"></div>
      <div class="absolute inset-0 flex items-center justify-center">
        <div class="text-6xl animate-pulse">ğŸŒ¾ğŸŒ¾ğŸŒ¾</div>
      </div>
    </div>

    <!-- ã‚³ãƒ³ãƒã‚¤ãƒ³ã®ã‚·ãƒ¼ãƒ³ -->
    <div id="combine" class="absolute inset-0 opacity-0 transition-opacity duration-1000">
      <div class="absolute inset-0 bg-gradient-to-b from-blue-200 via-yellow-100 to-amber-200"></div>
      <div class="absolute inset-0 flex items-center justify-center">
        <div class="text-6xl animate-bounce">ğŸšœ</div>
      </div>
    </div>

    <!-- ç‚Šãç«‹ã¦ã”é£¯ã®ã‚·ãƒ¼ãƒ³ -->
    <div id="cooked-rice" class="absolute inset-0 opacity-0 transition-opacity duration-1000">
      <div class="absolute inset-0 bg-gradient-to-br from-amber-50 via-orange-50 to-red-50"></div>
      <div class="absolute inset-0 flex items-center justify-center">
        <div class="relative">
          <div class="text-8xl animate-pulse">ğŸš</div>
          <!-- æ¹¯æ°—ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ -->
          <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 text-gray-300 text-2xl animate-ping">ğŸ’¨</div>
        </div>
      </div>
    </div>

  </div>

  <!-- ã‚¹ã‚­ãƒƒãƒ—ãƒœã‚¿ãƒ³ -->
  <div id="skip-button" class="fixed top-4 right-4 z-50">
    <%= form_with url: skip_animation_path, method: :post, local: true, class: "inline" do |f| %>
      <%= f.submit "ã‚¹ã‚­ãƒƒãƒ—", class: "bg-white/80 backdrop-blur-sm text-orange-600 px-4 py-2 rounded-full hover:bg-white transition duration-300 text-sm font-medium shadow-lg border border-orange-200" %>
    <% end %>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const scenes = ['rice-field', 'combine', 'cooked-rice'];
      let currentScene = 0;
      let animationSkipped = false;

      function showNextScene() {
        if (animationSkipped) return;

        // ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³ã‚’è¡¨ç¤º
        document.getElementById(scenes[currentScene]).classList.remove('opacity-0');
        document.getElementById(scenes[currentScene]).classList.add('opacity-100');

        currentScene++;

        if (currentScene < scenes.length) {
          setTimeout(() => {
            if (animationSkipped) return;
            // å‰ã®ã‚·ãƒ¼ãƒ³ã‚’éš ã™
            document.getElementById(scenes[currentScene - 1]).classList.add('opacity-0');
            document.getElementById(scenes[currentScene - 1]).classList.remove('opacity-100');
            showNextScene();
          }, 2500); // å°‘ã—é•·ã‚ã«è¡¨ç¤º
        } else {
          // æœ€å¾Œã®ã‚·ãƒ¼ãƒ³çµ‚äº†å¾Œã€è‡ªå‹•ã§ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«é·ç§»
          setTimeout(() => {
            if (!animationSkipped) {
              window.location.href = '<%= root_path %>';
            }
          }, 2500);
        }
      }

      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
      setTimeout(showNextScene, 500);

      // ã‚¹ã‚­ãƒƒãƒ—æ©Ÿèƒ½
      document.querySelector('form[action="<%= skip_animation_path %>"]').addEventListener('submit', function() {
        animationSkipped = true;
      });

      // Escã‚­ãƒ¼ã§ã‚¹ã‚­ãƒƒãƒ—
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          animationSkipped = true;
          window.location.href = '<%= root_path %>';
        }
      });
    });
  </script>
</body>
</html>
