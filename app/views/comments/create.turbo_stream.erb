<% if @comment.persisted? %>
  <!-- コメント投稿成功時のレスポンス -->

  <!-- コメント一覧の内容を更新（「まだコメントがありません」問題を解決） -->
  <%= turbo_stream.update "comments_list" do %>
    <% if @post.comments.any? %>
      <%= render partial: 'comments/comment', collection: @post.comments.order(created_at: :desc) %>
    <% else %>
      <div class="text-center py-8 text-gray-500">
        <%= icon_tag :hukidashi, class: "inline-block w-10 h-10 mr-2" %>
        <p class="text-sm">まだコメントがありません</p>
        <% if user_signed_in? %>
          <p class="text-xs mt-1">最初のコメントを投稿してみませんか？</p>
        <% end %>
      </div>
    <% end %>
  <% end %>

  <!-- コメントフォームをリセット -->
  <%= turbo_stream.replace "comment_form" do %>
    <%= render 'comments/form', post: @post, comment: Comment.new %>
  <% end %>

  <!-- コメント数を更新 -->
  <%= turbo_stream.update "comments_count" do %>
    <%= @post.comments.count %>
  <% end %>

<% else %>
  <!-- コメント投稿エラー時のレスポンス -->
  
  <!-- エラー付きフォームを表示 -->
  <%= turbo_stream.replace "comment_form" do %>
    <%= render 'comments/form', post: @post, comment: @comment %>
  <% end %>

<% end %>